To-do:

Create separate function / class for encoding commands

Separate command processing for master and replica. 